---
layout: '@components/Layout/LayoutChangelogs.astro'
# layout: '../../../../components/Layout.astro'
title: 'How to Compile Magic Lantern 2023 Working'
titlePostFix: 'Instruction'
tags: ['ah','yess']
description: |
    How to Compile Magic Lantern 2023 Working
    Guaranteed working (minus 1 thing) how to build Magic Lantern No fatal error!
keywords: 'tech, fun, novelty, open source, gratis, free, MagicLantern, Canon'
author: 'JOELwindows7'
twitterAuthor: '@JOELwindows7'
date: 2022-11-27
pubDate: 2022-11-27
dateMod: 2022-11-30
dateExp: 9999-12-31
thumbnail : '/assets/img/perkedelbannerrender4KDCI.png'
thumbnailType : 'image/png'
thumbnailWidth : 4096
thumbnailHeight : 2160
thumbnailAlt : 'Perkedel banner'
thumbnailAudio: ''
thumbnailVideo: ''
type : 'article'
descriptionPrefix : 'DO NOT RATIO'
noIndex : false
noFollow : false
rating : ''
favIcon: '/favicon.ico'
favIconHD : '/Perkedel_Icon.png'
favIconHDType : 'image/png'
favIconHDAlt : 'Perkedel icon'
favIconHDWidth : 600
favIconHDHeight : 400
charSet : 'UTF-8'
language : 'en'
twitterSite : '@JOELwindows7'
twitterCard : 'summary_large_image' 
themeColor : '#0000aa'
ejectClarity : false
hideInfo : false
SauceChangelogURL: 'https://github.com/Perkedel/perkedel-astro/blob/main/src/pages/apps/wceload/Canon/Compile/MagicLantern.mdx'
SauceChangelogURLDirect: 'https://github.com/Perkedel/perkedel-astro/raw/main/src/pages/apps/wceload/Canon/Compile/MagicLantern.mdx'
# url: 'vv'
url: 'MagicLantern' # wtf? the URL is no longer automatic?!?!??!?
---
import MessageBoxTemplate from "@components/Messages/MessageBoxTemplate.astro";

# How to compile & install Magic Lantern (2023 Working 100% minus 1%)
This is an instruction of how to compile &/or install Magic Lantern for your Canon EOS DSLR & Mirrorless camera (except PowerShot & EOS with PowerShot firmwares).  
Also featuring QEMU compilation instruction Working 2023 100% minus 1%.
{/* JOELwindows7: I have this camera. I gotta get this running! */}

<p class="warning">Some URL syntax below uses Markdown format (<code><span>[example_link](https://example.com)</span></code>) which is the ones without <code>🔗&#xf08e;</code> (External link) symbols next to it & won't open in new tab! <b>Be sure to always use Middle Click the URL without External Link Symbols if you like to make sure staying here.</b></p>

## Build Compile:
### Notes
You must use exactly **Debian 11, Bullseye**, in which this stable release has GCC & G++ `10` series which are compatible with the ML Simplified source code we will be using.  

#### Using Windows Subsystem for Linux 
{/* pls don't use header! */}
<MessageBoxTemplate severity={2} paragraphTitle={true} headingTitle="Windows Only" detailSummary="Only for Windows">
    <p>This feature is only available for <b>Windows atleast 10</b> & up</p>
</MessageBoxTemplate>

Download Debian WSL <a class="Buttonnize" href="https://www.microsoft.com/store/productId/9MSVKQC78PK6" target="_blank" rel="noopener noreferrer">here</a>.

Once installed, simply launch `Debian` app & configure your Debian WSL for the 1st time. **Make sure you remember your username & password for this WSL**.

#### Using virtual Machine / Container
Download the latest stable build of Debian, <a class="Buttonnize" href="https://www.debian.org/download" target="_blank" rel="noopener noreferrer">here</a>  
You only need the very top Netinst ISO file.

Make sure you also provided the virtual machine / container sufficient amount of specifications, e.g.:
- 3 Cores
- 2048 MB / 2 GB RAM
- 1020 x 720 display
- 20 GB reserved virtual disk space, we recommend using Dynamic Allocation

add / mount the Debian Netinst ISO you've just downloaded & boot from it. 
Follow instructions on the virtual screen. 
Don't forget to make your main user an admin / sudoers.
**Make sure you remember your username & all passwords (both main user & root) for this virtual machine / container**

##### Download the virtual machine / container image
- VHD. Coming soon

##### ERROR: `USERNAME is not in the sudoers file.  This incident will be reported.`
If somehow that after installation your main user did not exist in the sudoers group, you can do the following to fix this problem:
- Reboot to Recovery! 
    - When you started your container, you will first encounter `GRUB` or described as a selection inside a rectangle with countdown at the bottom. 
    - Immediately press arrow key to interupt the countdown.
    - select *`Advanced Options for Debian`*. `Enter`.
    - Pick the most recent Linux kernel version (usually on the top), and **PICK ONLY** the ones with `(recovery mode)` next to it.
    - Why recovery you ask? We assume since your user account failed to exist in the sudoers then any root command (including `su -` or `su root`) may go completely out of function.
    - We use this way for the best result possible.
- Wait until a blue screen with gray selection box appears.
- Pick *`root console`*. type your root password if asked.
- Make sure sudo is installed by trying to install `sudo`.
    - `apt-get install sudo -y`
    - If the result contains `sudo is already up to date`, and does not contain fatal errors, that mean you already have `sudo` installed yey!
- add your main user to `sudo` group by typing:
    - `adduser username sudo`
    - the `username` is your username, replace that with your username. 
    - e.g. say if your username is `godette`, you then instead type **`adduser godette sudo`** etc.
    - alternatively, you can use `usermod` command, so like `usermod -aG sudo YOUR_USERNAME`
- Just in case, set the correct permission in the sudoers configuration file:
    - `chmod  0440  /etc/sudoers`
    - usually, this file should already has proper permission as you installed Debian today.
    - unless you screwed up something including this, feel free to re-correct the permission once again just to be sure.
- exit the root console by typing `exit`, `Enter`, and reboot the virtual machine / container.
- Once you've came back to regular desktop, test your `sudo` first.
    - e.g. `sudo echo ahei dasandimian`
    - You should be able to see `ahei dasandimian` no problem if you followed this section instruction properly.

Further informations: 
<a href="https://www.linuxuprising.com/2019/09/fix-username-is-not-in-sudoers-file.html" target="_blank" rel="noopener noreferrer">https://www.linuxuprising.com/2019/09/fix-username-is-not-in-sudoers-file.html</a>
<a href="https://unix.stackexchange.com/a/258865/390514" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/a/258865/390514</a>

### Use Source Code Edition of
names_are_hard's Magic Lantern Simplified. <a class="Buttonnize" href="https://github.com/reticulatedpines/magiclantern_simplified" target="_blank" rel="noopener noreferrer">Here GitHub repository</a>  
the QEMU (simulates Canon firmware) will be on a separate repository of <a class="Buttonnize" href="https://github.com/reticulatedpines/qemu-eos" target="_blank" rel="noopener noreferrer">This GitHub repository</a>

#### Needed Package
You will need the following package, as we have collected, tested, & guessed the equivalent from various instructions:
- `git` **IMPORTANT**
- `mercurial` optional since our ML source code edition do not use `hg`
- `build-essential` **IMPORTANT**
- `make`
- `gcc`
- `gcc-arm-none-eabi`
- `python3-docutils`
- `python2`
- `bison`
- `flex`
- `zip`
- `unzip`
- `zlib1g-dev`
- `libgtk`
- `autoconf`
- `libtool`
- `libsdl-console`
- `libgtk2.0-dev`
- `mtools`
- `libsdl-console-dev`
- etc.

Therefore, pls do these commands bellow:
```bash
sudo apt update # to update repository cache
sudo apt upgrade -y # to upgrade all installed packaged, always confirm
# and these packages finally:
sudo apt install git build-essential make cmake gcc g++ gcc-arm-none-eabi zlib1g-dev libglib2.0 autoconf libtool libsdl-console flex bison libgtk2.0-dev mtools libsdl-console-dev install make gcc gcc-arm-none-eabi mercurial gcc-mingw-w64 python3-docutils zip
```
or use `synaptic` for graphical package management experience.  
Simply search by those package names above, mark them for installation, & apply.

### Steps:
#### Setup
clone these two. It is also recommended to clone them in a dedicated folder.
```bash
# (RECOMMENDED) make a special folder & go inside it
cd # or `cd ~`
mkdir -p sauce/simplified
cd sauce/simplified
# This to ensure you have tidy working space & clean home folder.

# Clone Magic Lantern Simplified
git clone https://github.com/reticulatedpines/magiclantern_simplified

# Clone the `qemu-eos`
git clone https://github.com/reticulatedpines/qemu-eos
```

#### Compilation
##### Magic Lantern itself

```bash
# Use the same special folder with instruction above or whereever `magiclantern_simplified` clone folder is
cd ~/sauce/simplified

# go to your Magic Lantern Simplified folder
cd magiclantern_simplified

# Go to which camera model you would like to compile for
# let's say you have 200D firmware v1.01, so go to 200D.101 platform folder!
cd platform/200D.101

# (OPTIONAL) you may need to update the documentations files
make docq
# PLS HELP: still failed

# then just make zip to compile & zip the ML package
make zip
```

You should see a zip file with names like this:
```
magiclantern-Nightly.YYYYMMMDD.MODELVERSION.zip
```

so say you have just compiled 200D firmware version 1.01 at certain date, so the file will looks like:
```
magiclantern-Nightly.2022Nov19.200D101.zip
```
<a class="Buttonnize" href="/assets/zip/magiclantern-Nightly.2022Nov19.200D101.zip" target="_blank" rel="noopener noreferrer">Download</a>

###### Furthermore
It is possible to compile & zip every single version exist in this ML repository.  
simply `make zip` in the root ML Simplified directory, without going to which platform folder.
```bash
cd ~/sauce/simplified/magiclantern_simplified
make zip
```

and as usual, the zip files will be on each platform folder.

##### QEMU EOS
Further informations:  
<a class="Buttonnize" href="https://github.com/reticulatedpines/qemu-eos/tree/qemu-eos-v4.2.1/magiclantern" target="_blank" rel="noopener noreferrer">https://github.com/reticulatedpines/qemu-eos/tree/qemu-eos-v4.2.1/magiclantern</a>

```bash
# Use the same special folder with instruction above or whereever `magiclantern_simplified` clone folder is
cd ~/sauce/simplified

# Make sure you have cloned `magiclantern_simplified` before,
# instruction above section

# Go inside `qemu-eos` you've just cloned, switch branch to v4.2.1, & then get out of it
cd qemu-eos; git switch qemu-eos-v4.2.1; cd ..
# Important, since the v4.2.1 branch is atleast the most compatible with our compilation library we have.

# Create separate build folder next to our QEMU called `qemu-eos-build`, then go inside it
mkdir qemu-eos-build
cd qemu-eos-build

# Begin the configuration procedure with the following parameters
../qemu-eos/configure --target-list=arm-softmmu --enable-plugins --disable-docs --enable-vnc --enable-gtk

# Make with 16 threads. 
# You can change how many thread you want, 
# but be sure not to get too high than your computer specification.
make -j16

# Make the plugins
make plugins

# Copy the Magic Lantern library into our QEMU plugin folder
cp tests/plugin/libmagiclantern.so arm-softmmu/plugins/

# Done. you can now run the QEMU.
# go back to `qemu-eos` repository & see the help for further instruction
cd ../qemu-eos/magiclantern
./run_qemu.py --help
# you will now run QEMU with that `run_qemu.py` command above.

# Be sure to provide your own ROM you dumped from your own Canon EOS camera!
# Perkedel nor X0p1r4t3 will not provide neither accepting sparsdated Canon ROM firmware files 
# due to abusive DMCA laws extradited from Earth where Canon comes from,
# unless Canon goes bankrupt & the files becomes rare & risk disappearing.
```

If you made some changes in this QEMU EOS, don't forget to recompile & 
make sure the Magic Lantern library is still placed properly to your QEMU EOS plugin folder
```bash
make -j16 && make plugins && cp tests/plugin/libmagiclantern.so arm-softmmu/plugins/
```
Note however, that you may need to do cleanup (instruction below) for the best result OR if the recompilation fails.

#### Re-compilation
Before recompiling after either change or not or something else, make sure you have cleaned up the compilation result for the best outcome possible by doing the following:
```bash
# cleanup Magic Lantern
cd ~/sauce/simplified/magiclantern_simplified
make clean

# return home
cd

# cleanup QEMU EOS
cd ~/sauce/simplified/qemu-eos-build
make clean
```

##### Magic Lantern itself
Simple go to which platform folder you'd like & then recompile
```bash
# for example to recompile 200D firmware v1.01 again..
cd ~/sauce/simplified/magiclantern
cd platform/200D.101
make zip

# OR you can recompile all versions of ML by start 
# compiling at the root of the repository instead of which platform
cd ~/sauce/simplified/magiclantern
make zip
```

##### QEMU EOS
You need to reconfigure the QEMU EOS again, then compile the QEMU & the plugins, 
& recopy the ML library back to QEMU plugin folder
```bash
# make sure you are still in the QEMU EOS build folder
cd ~/sauce/simplified/qemu-eos-build

# reconfigure so the compiler can see installed libraries you had right now
../qemu-eos/configure --target-list=arm-softmmu --enable-plugins --disable-docs --enable-vnc --enable-gtk

# start recompilation both the QEMU & plugins
# & recopy the ML library to the plugin folder.
make -j16 && make plugins && cp tests/plugin/libmagiclantern.so arm-softmmu/plugins/

```

## Installation
### Notes
For the impatient: just follow the quick install guide from the 
<a class="Buttonnize" href="http://builds.magiclantern.fm/" target="_blank" rel="noopener noreferrer">download page</a>. 
For a more thorough description of the install process, including what to do when things go wrong, keep reading.

### <mark class="warning">Caution & VERY IMPORTANT!!!</mark>
<MessageBoxTemplate severity={2} paragraphTitle={true} headingTitle={"Read Carefully"} detailSummary={"May possibly damage your camera, Read instruction real carefully!"} opens={true}>
    <img src="https://wiki.magiclantern.fm/_media/led-with-card-door-open-280.jpg" alt="LED Blinking & Card door open on the camera, pay attention!" width="25%" style="float:right"/>
    <ul>
        <li>Read the entire guide before performing any steps.</li>
        <li>You are responsible for any damage done to your camera.</li>
        <li><b style="font-size:1.4em;font-weight:bolder;">Never delete the Magic Lantern files from the card!</b> Format the card instead.</li>
        <li>After opening the card door, 
            <b class="error" style="font-size:1.4em;">always wait for LED confirmation</b> (or for 5 seconds) 
            before removing the card, 
            <mark style="font-weight:bold;font-size=1.4em;">even if your camera is turned off!!!</mark>
            </li>
        <li>Additionally for NEW INSTALL, there is a bug regarding to libUSB which workaround is available according to 
            <a href="https://www.magiclantern.fm/forum/index.php?topic=17969.msg240894#msg240894" target="_blank" rel="noopener noreferrer">
                This petabyt's thread reply
                </a>
            </li>
    </ul>
    <p>
        Right after opening the card door, Canon firmware <b>accesses the card without turning on the LED</b> 
        (yes, with the main switch turned off). 
        If you remove the card too early, the camera will freeze and will drain the battery, 
        or even cause <mark>permanent damage</mark>! You will be running random code 
        (remember you are loading executable code from the card), 
        and we can't do anything about it without reflashing Canon firmware with our own code.
    </p>
</MessageBoxTemplate>

### Steps:
#### NEW INSTALL (Work in Progress)
as in:
<a class="Buttonnize" href="https://wiki.magiclantern.fm/new-install" target="_blank" rel="noopener noreferrer">This <b>NEWER</b> Install Instruction</a> 
Please check this guide above for up to date instruction. Instructions will be syndicated here for redundancy, in event of disaster.

##### Compatible for:
Newer ML ports & relatively new camera
- 1300D / Kiss X80 / Rebel T6
- 4000D / 3000D / Rebel T100
For other models, please refer to Current Install section bellow.

##### Install
1. Connect the camera to a Windows 7/10 or Linux computer with a USB cable.
2. Download mlinstall ([https://github.com/petabyt/mlinstall](https://github.com/petabyt/mlinstall)).
3. On Windows, extract the files and run the EXE. On Linux, you'll need to set the `.AppImage` file as executable. Here's a quick tutorial: [https://discourse.appimage.org/t/how-to-run-an-appimage/80](https://discourse.appimage.org/t/how-to-run-an-appimage/80 )
    Here I click `Get Device Info`` to see if it can detect the device.
    ![Result of Clicked `Get Device Info`](https://wiki.magiclantern.fm/_media/new-install:mlinstall_1.png)

On first run on Windows, it should **not** work. Here's what to do:
1. <b class="error">DO NOT USE ZADIG for now! IT'S SLOW & DESTRUCTIVE!!</b> use [mcuee's libUSB](https://github.com/mcuee/libusb-win32/releases/download/snapshot_1.2.7.3/libusb-win32-bin-1.2.7.3.zip ) instead! [Learn more in petabyt's reply](https://www.magiclantern.fm/forum/index.php?topic=17969.msg240894#msg240894 )
2. (Backup) ~~Download and run [`Zadig`](https://zadig.akeo.ie/).~~
3. (Backup) ~~On the Canon Camera device, replace `WinUSB` with `libusb-win32` as in this GIF: [https://github.com/petabyt/mlinstall/blob/master/assets/zadig.gif](https://github.com/petabyt/mlinstall/blob/master/assets/zadig.gif)~~
4. (Backup) *In order to revert this change, simply repeat the steps and choose `WinUSB` instead of `libusb-win32`*. Some Windows software may fail to work if this change is not reverted.
5. (Backup) Once you have verified that USB communication is working, click `Enable Boot Disk`.
6. (Backup) *In order to revert the camera to factory settings, click `Disable Boot Disk`*.
    ![Enabling Bootdisk to the camera](https://wiki.magiclantern.fm/_media/new-install:mlinstall_2.png)
1. Unplug the camera SD card from the camera.
2. Insert the camera SD card into your computer. You might need an adapter.
3. Ensure that your SD card is named `EOS_DIGITAL`. mlinstall searches for a storage device named `EOS_DIGITAL` and writes to the first one it finds.
4. In mlinstall, navigate to the `Card` tab and click `Write card boot flags`. This will write data to the SD card. It's a good idea to format the card in the camera first.
5. *In Linux, eject / unmount the card before removing it*. Usually in your file manager left sidebar, you should see &#xf052; (Eject) Button next to `EOS_DIGITAL` media. Click the &#xf052; eject button to unmount the SD Card.
    ![Enabled Bootflag to the SD Card](https://wiki.magiclantern.fm/_media/new-install:mlinstall_3.png )
1. Once you have written the card flags, you will need to download a build for your camera. Make sure that the model ID and firmware version of your camera matches the build. (you can check it in the Canon menu). You might need to downgrade or upgrade.
2. Extract the Magic Lantern release zip file contents onto the SD card. Make sure that `autoexec.bin` and the `ML` folder are at the top directory, alongside `DCIM`.
    ![Basic folder structure of installed Magic Lantern in the SD Card](https://eggnog.theres.life/f/47-sha7lft66sci8ncxr5fu7bxeluj1s3.png)
1. Insert SD Card into camera and turn it on. On first startup, `ROM1` and `ROM0` will be backed up. In the picture settings screen in `M` (`MANUAL`) mode, press the `Q` / `Av` button (or &#xf1f8; `DELETE/TRASH` button).

##### Uninstalling Magic Lantern
1. Format the card <b class="warning">(and back up any data first!)</b>
2. Run mlinstall again and click `Disable Boot Disk`.

> Note that mlinstall has a `Destroy Card Boot Flags` feature that can make the SD Card non-bootable. (revert it to normal setting) After you run it, you will not need to format your card.

##### Troubleshooting
###### 1300D / Kiss X80 / Rebel T6
You may either have to downgrade or upgrade your firmware to a specific version. 
Here are some guides showing how to downgrade your firmware: 
- [https://magiclantern.fm/forum/index.php?topic=18941.0](https://magiclantern.fm/forum/index.php?topic=18941.0 )
- [https://www.magiclantern.fm/forum/index.php?topic=24926.0](https://www.magiclantern.fm/forum/index.php?topic=24926.0 )
A firmware file archive can be found here: 
- [https://pel.hu/eoscard/](https://pel.hu/eoscard/ )

> ccritix / critix: “Try to do a firmware update to version 1.1.0. (even if you have exactly this version on your device). Then you can try to test ML. This problem seems to exist on many devices. I suffered the same with my device. After an “update” to version 1.1.0, I was able to work on ML.”

{/* ==========================================

SEPARATE

============================================= */}

#### CURRENT INSTALL
as in:
<a class="Buttonnize" href="https://wiki.magiclantern.fm/install" target="_blank" rel="noopener noreferrer">This Install Instruction</a> 
Please check this guide above for up to date instruction. Instructions will be syndicated here for redundancy, in event of disaster.

##### Compatible for:
Any older cameras & cameras not listed on the New install above.
##### Get the right firmware version

##### First install guide
###### Step 1. Preparing your camera

###### Step 2. Installation
<img src="https://wiki.magiclantern.fm/_detail/new-installer.png?id=install" alt="Example of successful Magic Lantern installation" width="25%" style="float:right"/>

###### Step 3. Magic Lantern first startup

##### Installing Magic Lantern on other cards
<img src="https://wiki.magiclantern.fm/_media/eoscard2.jpg" alt="Screenshot of Pelican's EOScard Utility" width="25%" style="float:right"/>

##### Updating Magic Lantern
- Simply delete your old Magic Lantern files from your card and copy the new ones.
- You can keep your configuration files (the ML/SETTINGS directory from your card).

##### Uninstalling Magic Lantern
<MessageBoxTemplate severity={3} paragraphTitle={true} headingTitle={"DO NOT just delete the Magic Lantern files from the card!"} detailSummary={"If you do, the camera will freeze at startup and you'll have to take the battery out."} opens={true}>
    <p>Please follow below instruction on how to properly uninstall Magic Lantern!</p>
</MessageBoxTemplate>

###### Uninstalling ML from one card
- Format that card from the camera (select this option: *Format card*, ***remove Magic Lantern***) and reboot. Your camera will load the original firmware when you use that card.

###### Uninstalling ML from the camera
- With a Magic Lantern card, launch the **`Firmware Update`** process and follow the instructions on-screen.
- <mark class="warning">Re-installing Canon firmware will <b>not</b> remove Magic Lantern.</mark>

##### Troubleshooting
-

##### Important notes
- <mark class="warning" style="font-size:1.4em;font-weight:bolder;">After opening the card door, always wait for LED confirmation (or for 5 seconds) before removing the card!!!</mark>
- 
- **And, remember that this software can damage or destroy your camera.**

## Further steps
You may wanted to learn the following stuffs if you'd like to go further & perhaps contribute:
- `C`. A programming language. Core of everything and used to program things like an Operating system, including Linux kernel, Embedded devices, etc. Many programming languages takes inspiration from `C`'s syntax.
- [`Ghidra`](https://ghidra-sre.org). A Software Reverse Engineering framework built by researchers at National Security Agency in USA, Earth. Used to dissasemble binary files & allows deep analysis upon. You can use this to dissasemble Canon ROM files for let's say to find component addresses & help you build stubs.

## Credits
### Stuffs
- [ccritix's 3000D Platform folder](https://github.com/ccritix/magic-lantern/tree/branches/1300D/platform/4000D.100 ) Complete with Stubs. Lacks the Installation folder atm. OR try using libUSB method?
- [names_are_hard's how to QEMU in Magic Lantern Simplified](https://github.com/reticulatedpines/qemu-eos/tree/qemu-eos-v4.2.1/magiclantern )
- [`eos.c` in ccritix](https://github.com/ccritix/magic-lantern/blob/branches/1300D/contrib/qemu/eos/eos.c) Notice the `4000D` definition! Ctrl + F and take a look for `4000D` Flash ID & stuffs.
- [`eos.c` in names_are_hard](https://github.com/reticulatedpines/qemu-eos/blob/qemu-eos-v4.2.1/hw/eos/eos.c) No 4000D definition, but `1300D` definition! Ctrl + F that too, it's in **Enumeration**. I gotta bring this `4000D` in!
- [https://github.com/reticulatedpines/qemu-eos/tree/qemu-eos-v4.2.1/magiclantern](https://github.com/reticulatedpines/qemu-eos/tree/qemu-eos-v4.2.1/magiclantern)

## End
by JOELwindows7  
Perkedel Technologies  
CC4.0-BY-SA
